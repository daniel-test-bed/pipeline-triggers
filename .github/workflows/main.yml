name: CI
on:
  issue_comment:
    types:
     - created
     - edited
jobs:    
  mustpass:
      # This job only runs for pull request comments
      name: Job Must Pass
      runs-on: ubuntu-latest
      if: ${{ github.event.issue.pull_request && github.event.comment.body == '/run pipeline' }}
      steps:
        - uses: actions/checkout@v3
          with:
            ref: ${{ github.event.pull_request.head.sha }}
            
        - run: |
            echo "${{ github.event.comment.body }}"
            ls
        - name: Update check status
          if: ${{ success() }}
          # set the merge commit status check
          # using GitHub REST API
          # see https://docs.github.com/en/rest/reference/repos#create-a-commit-status
          run: |
            curl --request POST \
            --url https://api.github.com/repos/${{ github.repository }}/statuses/${{ github.event.issue.sha }} \
            --header 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \
            --header 'content-type: application/json' \
            --data '{
              "context": "Job Must Pass",
              "state": "success",
              "description": "Job Must Pass",
              "target_url": "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
            }'

